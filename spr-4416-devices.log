(base) n869p538@sapphire:configs$ cat /sys/bus/dsa/devices/dsa0/pasid_enabled
0

(base) n869p538@sapphire:configs$ cat /proc/cmdline 
BOOT_IMAGE=/vmlinuz-5.15.0-89-generic root=/dev/mapper/ubuntu--vg-ubuntu--lv ro intel_iommu=on,sm_on

(base) n869p538@sapphire:configs$ ls -df /sys/bus/dsa/devices/dsa*
/sys/bus/dsa/devices/dsa0  /sys/bus/dsa/devices/dsa2
(base) n869p538@sapphire:configs$ ls -df /sys/bus/dsa/devices/iax*
/sys/bus/dsa/devices/iax1  /sys/bus/dsa/devices/iax3

(base) n869p538@sapphire:configs$ sudo accel-config config-wq --group-id=0 --mode=dedicated --type=user --wq-size=16 --driver-name=idxd --name=dma_app --priority=10 dsa0/wq0.0
(base) n869p538@sapphire:configs$ sudo accel-config config-engine dsa0/engine0.0 --group-id=0
(base) n869p538@sapphire:configs$ sudo accel-config enable-device dsa0
enabled 1 device(s) out of 1
(base) n869p538@sapphire:configs$ sudo accel-config enable-wq dsa0/wq0.0

(base) n869p538@sapphire:configs$ sudo accel-config list
[
  {
    "dev":"dsa0",
    "read_buffer_limit":0,
    "max_groups":4,
    "max_work_queues":8,
    "max_engines":4,
    "work_queue_size":128,
    "numa_node":0,
    "gen_cap":"0x40915f0107",
    "version":"0x100",
    "state":"enabled",
    "max_read_buffers":96,
    "max_batch_size":1024,
    "max_transfer_size":2147483648,
    "configurable":1,
    "pasid_enabled":0,
    "cdev_major":511,
    "clients":0,
    "groups":[
      {
        "dev":"group0.0",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1,
        "grouped_workqueues":[
          {
            "dev":"wq0.0",
            "mode":"dedicated",
            "size":16,
            "group_id":0,
            "priority":10,
            "block_on_fault":0,
            "max_batch_size":1024,
            "max_transfer_size":2147483648,
            "cdev_minor":0,
            "type":"user",
            "name":"dma_app",
            "threshold":0,
            "ats_disable":0,
            "state":"enabled",
            "clients":0
          }
        ],
        "grouped_engines":[
          {
            "dev":"engine0.0",
            "group_id":0
          }
        ]
      },
      {
        "dev":"group0.1",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1
      },
      {
        "dev":"group0.2",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1
      },
      {
        "dev":"group0.3",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1
      }
    ],
    "ungrouped_engines":[
      {
        "dev":"engine0.1"
      },
      {
        "dev":"engine0.2"
      },
      {
        "dev":"engine0.3"
      }
    ]
  }
]

(base) n869p538@sapphire:configs$ ls  /sys/bus/dsa/devices/dsa*
/sys/bus/dsa/devices/dsa0:
cdev_major    driver     engine0.3  group0.1        max_engines        max_work_queues       pasid_enabled  token_limit  wq0.1  wq0.5
clients       engine0.0  errors     group0.2        max_groups         max_work_queues_size  power          uevent       wq0.2  wq0.6
cmd_status    engine0.1  gen_cap    group0.3        max_tokens         numa_node             state          version      wq0.3  wq0.7
configurable  engine0.2  group0.0   max_batch_size  max_transfer_size  op_cap                subsystem      wq0.0        wq0.4

/sys/bus/dsa/devices/dsa2:
cdev_major  configurable  engine2.2  gen_cap   group2.2        max_engines  max_transfer_size     numa_node      power      token_limit  wq2.0  wq2.3  wq2.6
clients     engine2.0     engine2.3  group2.0  group2.3        max_groups   max_work_queues       op_cap         state      uevent       wq2.1  wq2.4  wq2.7
cmd_status  engine2.1     errors     group2.1  max_batch_size  max_tokens   max_work_queues_size  pasid_enabled  subsystem  version      wq2.2  wq2.5


(base) n869p538@sapphire:configs$ ls  /sys/bus/dsa/devices/iax*
/sys/bus/dsa/devices/iax1:
cdev_major    engine1.0  engine1.4  errors    group1.2        max_groups         max_work_queues_size  power        uevent   wq1.2  wq1.6
clients       engine1.1  engine1.5  gen_cap   group1.3        max_tokens         numa_node             state        version  wq1.3  wq1.7
cmd_status    engine1.2  engine1.6  group1.0  max_batch_size  max_transfer_size  op_cap                subsystem    wq1.0    wq1.4
configurable  engine1.3  engine1.7  group1.1  max_engines     max_work_queues    pasid_enabled         token_limit  wq1.1    wq1.5

/sys/bus/dsa/devices/iax3:
cdev_major    engine3.0  engine3.4  errors    group3.2        max_groups         max_work_queues_size  power        uevent   wq3.2  wq3.6
clients       engine3.1  engine3.5  gen_cap   group3.3        max_tokens         numa_node             state        version  wq3.3  wq3.7
cmd_status    engine3.2  engine3.6  group3.0  max_batch_size  max_transfer_size  op_cap                subsystem    wq3.0    wq3.4
configurable  engine3.3  engine3.7  group3.1  max_engines     max_work_queues    pasid_enabled         token_limit  wq3.1    wq3.5



(base) n869p538@sapphire:configs$ sudo accel-config config-wq --group-id=0 --mode=dedicated --type=user --wq-size=16 --driver-name=idxd --name=comp_app --priority=10 iax1/wq1.0
(base) n869p538@sapphire:configs$ sudo accel-config config-engine iax1/engine1.0 --group-id=0
(base) n869p538@sapphire:configs$ sudo accel-config enable-device iax1
enabled 1 device(s) out of 1
(base) n869p538@sapphire:configs$ sudo accel-config enable-wq iax1/wq1.0
enabled 1 wq(s) out of 1


(base) n869p538@sapphire:configs$ sudo accel-config list
[
  {
    "dev":"dsa0",
    "read_buffer_limit":0,
    "max_groups":4,
    "max_work_queues":8,
    "max_engines":4,
    "work_queue_size":128,
    "numa_node":0,
    "gen_cap":"0x40915f0107",
    "version":"0x100",
    "state":"enabled",
    "max_read_buffers":96,
    "max_batch_size":1024,
    "max_transfer_size":2147483648,
    "configurable":1,
    "pasid_enabled":0,
    "cdev_major":511,
    "clients":0,
    "groups":[
      {
        "dev":"group0.0",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1,
        "grouped_workqueues":[
          {
            "dev":"wq0.0",
            "mode":"dedicated",
            "size":16,
            "group_id":0,
            "priority":10,
            "block_on_fault":0,
            "max_batch_size":1024,
            "max_transfer_size":2147483648,
            "cdev_minor":0,
            "type":"user",
            "name":"dma_app",
            "threshold":0,
            "ats_disable":0,
            "state":"enabled",
            "clients":0
          }
        ],
        "grouped_engines":[
          {
            "dev":"engine0.0",
            "group_id":0
          }
        ]
      },
      {
        "dev":"group0.1",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1
      },
      {
        "dev":"group0.2",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1
      },
      {
        "dev":"group0.3",
        "read_buffers_reserved":0,
        "use_read_buffer_limit":0,
        "read_buffers_allowed":0,
        "traffic_class_a":1,
        "traffic_class_b":1
      }
    ],
    "ungrouped_engines":[
      {
        "dev":"engine0.1"
      },
      {
        "dev":"engine0.2"
      },
      {
        "dev":"engine0.3"
      }
    ]
  },
  {
    "dev":"iax1",
    "max_groups":4,
    "max_work_queues":8,
    "max_engines":8,
    "work_queue_size":128,
    "numa_node":0,
    "gen_cap":"0x71f10901f0105",
    "version":"0x100",
    "state":"enabled",
    "max_batch_size":1,
    "max_transfer_size":2147483648,
    "configurable":1,
    "pasid_enabled":0,
    "cdev_major":510,
    "clients":0,
    "groups":[
      {
        "dev":"group1.0",
        "traffic_class_a":1,
        "traffic_class_b":1,
        "grouped_workqueues":[
          {
            "dev":"wq1.0",
            "mode":"dedicated",
            "size":16,
            "group_id":0,
            "priority":10,
            "block_on_fault":0,
            "max_batch_size":1,
            "max_transfer_size":2147483648,
            "cdev_minor":0,
            "type":"user",
            "name":"comp_app",
            "threshold":0,
            "ats_disable":0,
            "state":"enabled",
            "clients":0
          }
        ],
        "grouped_engines":[
          {
            "dev":"engine1.0",
            "group_id":0
          }
        ]
      },
      {
        "dev":"group1.1",
        "traffic_class_a":1,
        "traffic_class_b":1
      },
      {
        "dev":"group1.2",
        "traffic_class_a":1,
        "traffic_class_b":1
      },
      {
        "dev":"group1.3",
        "traffic_class_a":1,
        "traffic_class_b":1
      }
    ],
    "ungrouped_engines":[
      {
        "dev":"engine1.1"
      },
      {
        "dev":"engine1.2"
      },
      {
        "dev":"engine1.3"
      },
      {
        "dev":"engine1.4"
      },
      {
        "dev":"engine1.5"
      },
      {
        "dev":"engine1.6"
      },
      {
        "dev":"engine1.7"
      }
    ]
  }
]
(base) n869p538@sapphire:configs$

